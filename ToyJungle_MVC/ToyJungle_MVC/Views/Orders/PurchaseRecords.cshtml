@using Microsoft.AspNetCore.Http;
@{
    ViewBag.Title = "PurchaseRecords";
}

<script src="~/assets/alertifyjs/alertify.min.js "></script>
<link rel="stylesheet" href="~/assets/alertifyjs/css/alertify.min.css" />
<link rel="stylesheet" href="`/assets/alertifyjs/css/themes/default.min.css" />

<script src="~/assets/js/angular.min.js"></script>
<script src="~/assets/js/angular-sanitize.min.js"></script>
<script>
        var app = angular.module('myApp', []);
        app.controller('customersCtrl', function ($scope, $http, $location) {
            var BaseUrl = "https://localhost:44393/";
            $scope.Keyword = "";
            $scope.Orders = null;
            $scope.ShowPanel = "Orders";
            $scope.SelectedOrder = null;
            $scope.SelectOrder = function (Order) {
                $scope.SelectedOrder = Order;
                $scope.ToggleShowPanel('Details');
            }
            $scope.ToggleShowPanel = function (Panel) {
                $scope.ShowPanel = Panel;
            }

            $scope.Search = function () {
               // alert();
                //if ($scope.Keyword == null) return;
                $http.get(BaseUrl+"api/orders/SearchByUID/" + '@ViewBag.UID').then(function (response) {
                    $scope.Orders = response.data;
                    console.log($scope.Orders);

                });


            }
            $scope.Search();


        });


</script>

<div ng-app="myApp" onload="Load()" ng-controller="customersCtrl">

    <div class="container d-xl-flex align-items-xl-center" style="margin-top: 20px;">
        <h4 class="flex-fill">Purchase Record</h4>

    </div>
    <hr />
    <div ng-show="ShowPanel=='Orders'" class="container" style="margin-top: 20px;">
        <div class="table-responsive bg-white shadow-sm">
            <div ng-show="Orders.length==0" role="alert" class="alert alert-danger"><span><strong>!!!</strong> No Record Found.</span></div>
            <table class="table table-striped table-hover">
                <thead>
                    <tr>
                        <th style="width: 37px;">Sn.</th>
                        <th>Order Number</th>
                        <th>Date</th>
                        <th style="width: 180px;">Bill Amount</th>
                    </tr>
                </thead>
                <tbody>
                    <tr ng-repeat="Order in Orders" ng-click="SelectOrder(Order)">
                        <td>{{$index+1}}</td>
                        <td>{{Order.orderNumber}}</td>
                        <td>{{Order.orderDateTime}}</td>
                        <td>{{Order.billAmount}}</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <div ng-show="ShowPanel=='Details'" class="container" style="margin-top: 20px;">
        <div class="card">
            <div class="card-header"><button ng-click="ToggleShowPanel('Orders')" class="btn btn-dark" type="button">Back</button></div>
            <div class="table-responsive">
                <table class="table table-striped">
                    <thead>
                        <tr>
                            <th style="width: 37px;">Sn.</th>
                            <th>Product Name</th>
                            <th>Price</th>
                            <th style="width: 259px;">Quantity</th>
                            <th style="width: 144px;">Total</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr ng-repeat="Product in SelectedOrder.items">
                            <td>{{$index+1}}</td>
                            <td>{{Product.productName}}</td>
                            <td>{{Product.price}}</td>
                            <td>{{Product.quantity}}</td>
                            <td>{{Product.price * Product.quantity}}</td>
                        </tr>
                    </tbody>

                </table>
            </div>
        </div>
    </div>

</div>
